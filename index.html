<!-- index.html -->
<!doctype html>
<html lang="it">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Rilievo Pozzetti (PWA demo)</title>

  <link rel="manifest" href="./manifest.json">
  <meta name="theme-color" content="#1f4fd8" />

  <link rel="stylesheet" href="./style.css">
  <link rel="stylesheet" href="./vendor/cropper/cropper.min.css">
</head>

<body>
  <header>
    <h1>Rilievo Pozzetti</h1>
    <div class="badge" id="netStatus">‚Ä¶</div>
  </header>

  <main>
    <!-- DATI GENERALI (persistenti) -->
    <section class="card">
      <h2 class="sectionTitle">Dati generali</h2>

      <div class="grid2">
        <label>
          COMUNE
          <input id="introComune" placeholder="es. Milano" />
        </label>

        <label>
          VIA
          <input id="introVia" placeholder="es. Via Roma" />
        </label>

        <label>
          CIVICO
          <input id="introCivico" placeholder="es. 12" />
        </label>

        <label>
          DATA RILIEVO
          <input id="introDataRilievo" type="date" />
        </label>

        <label>
          Rilevatore
          <input id="introRilevatore" placeholder="Nome azienda" />
        </label>
      </div>

      <div class="row wrap" style="margin-top:10px;">
        <button id="btnClearIntro" type="button" class="secondary">üßπ Cancella dati generali</button>
      </div>

      <p class="hint">
        Questi campi vengono salvati sul dispositivo e riutilizzati automaticamente per tutte le schede, finch√© non li modifichi o li cancelli.
      </p>
    </section>

    <!-- DATI SCHEDA -->
    <section class="card">
      <h2 class="sectionTitle">Dati scheda</h2>

      <div class="grid2">
        <label>
          ID Scheda
          <input id="idScheda" placeholder="es. 1" data-num="int" data-required="1" data-label="ID Scheda" />
        </label>

        <label>
          Tipologia rete
          <select id="tipologiaRete">
            <option value="" selected>‚Äî Seleziona ‚Äî</option>
            <option>Acquedotto</option>
            <option>Antincendio</option>
            <option>Elettrico</option>
            <option>Fibra</option>
            <option>Fognatura</option>
            <option>Gas</option>
            <option>Irrigazione</option>
            <option value="ALTRO">Altro</option>
          </select>
          <input id="tipologiaReteAltro" class="altro" placeholder="Specificare tipologia rete" />
        </label>

        <!-- visibile solo se Tipologia rete = Fognatura -->
        <div id="wrapTipologiaFognatura" class="hiddenBlock">
          <label>
            Tipologia fognatura
            <select id="tipologiaFognatura">
              <option value="" selected>‚Äî Seleziona ‚Äî</option>
              <option>Acque Tecnologiche</option>
              <option>Bianca</option>
              <option>Depurata</option>
              <option>Mista</option>
              <option>Nera</option>
              <option>Sfiorata</option>
              <option value="ALTRO">Altro</option>
            </select>
            <input id="tipologiaFognaturaAltro" class="altro" placeholder="Specificare tipologia" />
          </label>
        </div>

        <label>
          Stato servizio
          <select id="statoServizio">
            <option value="" selected>‚Äî Seleziona ‚Äî</option>
            <option>Demolito - non pi√π esistente</option>
            <option>Dismesso</option>
            <option>In esercizio</option>
            <option>In progetto</option>
            <option>Non in esercizio</option>
            <option value="ALTRO">Altro</option>
          </select>
          <input id="statoServizioAltro" class="altro" placeholder="Specificare stato" />
        </label>

        <label>
          Accessibilit√†
          <select id="accessibilita">
            <option value="" selected>‚Äî Seleziona ‚Äî</option>
            <option>No</option>
            <option>No, asfaltata</option>
            <option>No, cameretta priva di accesso</option>
            <option>No, chiusino non accessibile</option>
            <option>No, coperta</option>
            <option>No, sigillata</option>
            <option>No, sigillo rotto</option>
            <option>Si</option>
            <option>Non conosciuto</option>
          </select>
        </label>

        <label>
          Posizione su strada
          <select id="posizioneStrada">
            <option value="" selected>‚Äî Seleziona ‚Äî</option>
            <option>Area</option>
            <option>Area Campestre</option>
            <option>Area Pedonale</option>
            <option>Aiuola</option>
            <option>Attraversamento</option>
            <option>Banchina</option>
            <option>Carreggiata</option>
            <option>Carreggiata centrale</option>
            <option>Carreggiata dispari</option>
            <option>Carreggiata e marciapiede dispari</option>
            <option>Carreggiata e marciapiede pari</option>
            <option>Carreggiata pari</option>
            <option>Cunicolo</option>
            <option>Marciapiede</option>
            <option>Marciapiede dispari</option>
            <option>Marciapiede pari</option>
            <option>Muro</option>
            <option>Parcheggi</option>
            <option>Parterre</option>
            <option>Parterre e marciapiedi</option>
            <option>Pista ciclabile</option>
            <option>Spartitraffico</option>
            <option>Strada-aiuola</option>
            <option>Strada-parallela (entro 2m)</option>
            <option>Strada-scalinata</option>
            <option>Sub-alveo</option>
            <option>su due lati</option>
            <option>su un lato</option>
            <option>Terreno</option>
            <option>ND</option>
            <option value="ALTRO">Altro</option>
          </select>
          <input id="posizioneStradaAltro" class="altro" placeholder="Specificare posizione" />
        </label>

        <label>
          Superficie di posa
          <select id="superficiePosa">
            <option value="" selected>‚Äî Seleziona ‚Äî</option>
            <option>Asfalto</option>
            <option>Autobloccanti</option>
            <option>Cemento</option>
            <option>Ciotoli</option>
            <option>Cubetti di porfido</option>
            <option>Lastre di pietra</option>
            <option>Pietra</option>
            <option>Sterrato</option>
            <option>Terra</option>
            <option>ND</option>
            <option value="ALTRO">Altro</option>
          </select>
          <input id="superficiePosaAltro" class="altro" placeholder="Specificare superficie" />
        </label>

        <label>
          Tipo punto (categoria)
          <select id="tipoPuntoMacro">
            <option value="" selected>‚Äî Seleziona ‚Äî</option>
          </select>
        </label>

        <label>
          Tipo punto (sottocategoria)
          <select id="tipoPuntoSub" disabled>
            <option value="" selected>‚Äî Seleziona categoria prima ‚Äî</option>
          </select>
          <input id="tipoPuntoAltro" class="altro" placeholder="Specificare tipo punto" />
        </label>
      </div>
    </section>

    <!-- DATI MANUFATTO -->
    <section class="card">
      <h2 class="sectionTitle">Dati relativi al manufatto rilevato</h2>

      <h3 class="subhead">Chiusino</h3>
      <div class="grid3">
        <label>
          Materiale Chiusino
          <select id="materiale">
            <option value="" selected>‚Äî Seleziona ‚Äî</option>
            <option>Acciaio</option>
            <option>Acciaio inossidabile</option>
            <option>Acciaio legato</option>
            <option>Acciaio plastificato</option>
            <option>Acciaio verniciato</option>
            <option>Acciaio zincato</option>
            <option>Calcestruzzo di poliestere</option>
            <option>Cemento amianto</option>
            <option>Cemento armato polimero</option>
            <option>CLS</option>
            <option>CLS fondo Gres</option>
            <option>CLS Gettato</option>
            <option>CLS Prefabbricato</option>
            <option>CLS Prefabbricato fondo gres</option>
            <option>Ferro</option>
            <option>Fibrocemento</option>
            <option>Ghisa</option>
            <option>Ghisa grigia (con grafite lamellare)</option>
            <option>Ghisa sferoidale</option>
            <option>Gres ceramico</option>
            <option>Lamiera</option>
            <option>Lamiera Zincata</option>
            <option>Legno</option>
            <option>Metallo</option>
            <option>Miscela di materiali diversi</option>
            <option>Muratura</option>
            <option>Ottone</option>
            <option>PEAD</option>
            <option>PEAD - 100</option>
            <option>PEAD - 80</option>
            <option>Pietra</option>
            <option>Polietilene</option>
            <option>Polietilene normalizzato esterno</option>
            <option>Poliestere</option>
            <option>Polipropilene</option>
            <option>PVC</option>
            <option>PVC  forte</option>
            <option>Resina di poliestere</option>
            <option>Resina termoindurente rinforzata con fibre vetro</option>
            <option>Non applicabile</option>
            <option>Non assegnato</option>
            <option>Non conosciuto</option>
            <option>Non definito</option>
            <option value="ALTRO">Altro</option>
          </select>
          <input id="materialeAltro" class="altro" placeholder="Specificare materiale" />
        </label>

        <label>
          Posizione chiusino
          <select id="posizioneChiusino">
            <option value="" selected>‚Äî Seleziona ‚Äî</option>
            <option>A raso</option>
            <option>Interrato</option>
            <option>Sopraelevato/pensile</option>
            <option>Non conosciuto</option>
            <option value="ALTRO">Altro</option>
          </select>
          <input id="posizioneChiusinoAltro" class="altro" placeholder="Specificare posizione" />
        </label>

        <label>
          Forma chiusino
          <select id="formaChiusino">
            <option value="" selected>‚Äî Seleziona ‚Äî</option>
            <option>Cerchio</option>
            <option>Cunicolo</option>
            <option>Elittica</option>
            <option>Fondi Sagomati</option>
            <option>Nessuna</option>
            <option>Ovale</option>
            <option>Ovoidale</option>
            <option>Policentrica</option>
            <option>Quadrato</option>
            <option>Rettangolo</option>
            <option>Semicircolare</option>
            <option>Semi ovale</option>
            <option>Trapezoidale</option>
            <option>Triangolare</option>
            <option>Non applicabile</option>
            <option>Non assegnato</option>
            <option>Non conosciuto</option>
            <option>Non definito</option>
            <option value="ALTRO">Altro</option>
          </select>
          <input id="formaChiusinoAltro" class="altro" placeholder="Specificare forma" />
        </label>

        <label>
          Lunghezza chiusino (cm)
          <input id="lunghezzaChiusino" inputmode="numeric" placeholder="es. 60" data-num="int" data-label="Lunghezza chiusino (cm)" />
        </label>

        <label>
          Larghezza chiusino (cm)
          <input id="larghezzaChiusino" inputmode="numeric" placeholder="es. 60" data-num="int" data-label="Larghezza chiusino (cm)" />
        </label>

        <label>
          Diametro chiusino (cm)
          <input id="diametroChiusino" inputmode="numeric" placeholder="es. 60" data-num="int" data-label="Diametro chiusino (cm)" />
        </label>

        <label>
          Altro (Chiusino)
          <input id="altroChiusino" placeholder="Note aggiuntive (facoltativo)" />
        </label>
      </div>

      <h3 class="subhead">Banchina</h3>
      <div class="grid3">
        <label>
          Presenza banchina
          <select id="presenzaBanchina">
            <option value="" selected>‚Äî Seleziona ‚Äî</option>
            <option>No</option>
            <option>Si</option>
          </select>
        </label>

        <label>
          Profondit√† banchina (cm)
          <input id="profonditaBanchina" inputmode="numeric" placeholder="es. 30" data-num="int" data-label="Profondit√† banchina (cm)" />
        </label>

        <label>
          Altro (Banchina)
          <input id="altroBanchina" placeholder="Note aggiuntive (facoltativo)" />
        </label>
      </div>

      <h3 class="subhead">Torrino</h3>
      <div class="grid3">
        <label>
          Materiale torrino
          <select id="materialeTorrino">
            <option value="" selected>‚Äî Seleziona ‚Äî</option>
            <option>Acciaio</option>
            <option>Acciaio inossidabile</option>
            <option>Acciaio legato</option>
            <option>Acciaio plastificato</option>
            <option>Acciaio verniciato</option>
            <option>Acciaio zincato</option>
            <option>Calcestruzzo di poliestere</option>
            <option>Cemento amianto</option>
            <option>Cemento armato polimero</option>
            <option>CLS</option>
            <option>CLS fondo Gres</option>
            <option>CLS Gettato</option>
            <option>CLS Prefabbricato</option>
            <option>CLS Prefabbricato fondo gres</option>
            <option>Ferro</option>
            <option>Fibrocemento</option>
            <option>Ghisa</option>
            <option>Ghisa grigia (con grafite lamellare)</option>
            <option>Ghisa sferoidale</option>
            <option>Gres ceramico</option>
            <option>Lamiera</option>
            <option>Lamiera Zincata</option>
            <option>Legno</option>
            <option>Metallo</option>
            <option>Miscela di materiali diversi</option>
            <option>Muratura</option>
            <option>Ottone</option>
            <option>PEAD</option>
            <option>PEAD - 100</option>
            <option>PEAD - 80</option>
            <option>Pietra</option>
            <option>Polietilene</option>
            <option>Polietilene normalizzato esterno</option>
            <option>Poliestere</option>
            <option>Polipropilene</option>
            <option>PVC</option>
            <option>PVC  forte</option>
            <option>Resina di poliestere</option>
            <option>Resina termoindurente rinforzata con fibre vetro</option>
            <option>Non applicabile</option>
            <option>Non assegnato</option>
            <option>Non conosciuto</option>
            <option>Non definito</option>
            <option value="ALTRO">Altro</option>
          </select>
          <input id="materialeTorrinoAltro" class="altro" placeholder="Specificare materiale torrino" />
        </label>

        <label>
          Forma torrino
          <select id="formaTorrino">
            <option value="" selected>‚Äî Seleziona ‚Äî</option>
            <option>Cerchio</option>
            <option>Cunicolo</option>
            <option>Elittica</option>
            <option>Fondi Sagomati</option>
            <option>Nessuna</option>
            <option>Ovale</option>
            <option>Ovoidale</option>
            <option>Policentrica</option>
            <option>Quadrato</option>
            <option>Rettangolo</option>
            <option>Semicircolare</option>
            <option>Semi ovale</option>
            <option>Trapezoidale</option>
            <option>Triangolare</option>
            <option>Non applicabile</option>
            <option>Non assegnato</option>
            <option>Non conosciuto</option>
            <option>Non definito</option>
            <option value="ALTRO">Altro</option>
          </select>
          <input id="formaTorrinoAltro" class="altro" placeholder="Specificare forma torrino" />
        </label>

        <label>
          Lunghezza torrino (cm)
          <input id="lunghezzaTorrino" inputmode="numeric" placeholder="es. 60" data-num="int" data-label="Lunghezza torrino (cm)" />
        </label>

        <label>
          Larghezza torrino (cm)
          <input id="larghezzaTorrino" inputmode="numeric" placeholder="es. 60" data-num="int" data-label="Larghezza torrino (cm)" />
        </label>

        <label>
          Diametro torrino (cm)
          <input id="diametroTorrino" inputmode="numeric" placeholder="es. 60" data-num="int" data-label="Diametro torrino (cm)" />
        </label>

        <label>
          Altro (Torrino)
          <input id="altroTorrino" placeholder="Note aggiuntive (facoltativo)" />
        </label>
      </div>

      <h3 class="subhead">Pozzetto</h3>
      <div class="grid3">
        <label>
          Materiale pozzetto
          <select id="materialePozzetto">
            <option value="" selected>‚Äî Seleziona ‚Äî</option>
            <option>Acciaio</option>
            <option>Acciaio inossidabile</option>
            <option>Acciaio legato</option>
            <option>Acciaio plastificato</option>
            <option>Acciaio verniciato</option>
            <option>Acciaio zincato</option>
            <option>Calcestruzzo di poliestere</option>
            <option>Cemento amianto</option>
            <option>Cemento armato polimero</option>
            <option>CLS</option>
            <option>CLS fondo Gres</option>
            <option>CLS Gettato</option>
            <option>CLS Prefabbricato</option>
            <option>CLS Prefabbricato fondo gres</option>
            <option>Ferro</option>
            <option>Fibrocemento</option>
            <option>Ghisa</option>
            <option>Ghisa grigia (con grafite lamellare)</option>
            <option>Ghisa sferoidale</option>
            <option>Gres ceramico</option>
            <option>Lamiera</option>
            <option>Lamiera Zincata</option>
            <option>Legno</option>
            <option>Metallo</option>
            <option>Miscela di materiali diversi</option>
            <option>Muratura</option>
            <option>Ottone</option>
            <option>PEAD</option>
            <option>PEAD - 100</option>
            <option>PEAD - 80</option>
            <option>Pietra</option>
            <option>Polietilene</option>
            <option>Polietilene normalizzato esterno</option>
            <option>Poliestere</option>
            <option>Polipropilene</option>
            <option>PVC</option>
            <option>PVC forte</option>
            <option>Resina di poliestere</option>
            <option>Resina termoindurente rinforzata con fibre vetro</option>
            <option>Non applicabile</option>
            <option>Non assegnato</option>
            <option>Non conosciuto</option>
            <option>Non definito</option>
            <option value="ALTRO">Altro</option>
          </select>
          <input id="materialePozzettoAltro" class="altro" placeholder="Specificare materiale pozzetto" />
        </label>

        <label>
          Forma pozzetto
          <select id="formaPozzetto">
            <option value="" selected>‚Äî Seleziona ‚Äî</option>
            <option>Cerchio</option>
            <option>Cunicolo</option>
            <option>Elittica</option>
            <option>Fondi Sagomati</option>
            <option>Nessuna</option>
            <option>Ovale</option>
            <option>Ovoidale</option>
            <option>Policentrica</option>
            <option>Quadrato</option>
            <option>Rettangolo</option>
            <option>Semicircolare</option>
            <option>Semi ovale</option>
            <option>Trapezoidale</option>
            <option>Triangolare</option>
            <option>Non applicabile</option>
            <option>Non assegnato</option>
            <option>Non conosciuto</option>
            <option>Non definito</option>
            <option value="ALTRO">Altro</option>
          </select>
          <input id="formaPozzettoAltro" class="altro" placeholder="Specificare forma pozzetto" />
        </label>

        <label>
          Lunghezza pozzetto (cm)
          <input id="lunghezzaPozzetto" inputmode="numeric" placeholder="es. 100" data-num="int" data-label="Lunghezza pozzetto (cm)" />
        </label>

        <label>
          Larghezza pozzetto (cm)
          <input id="larghezzaPozzetto" inputmode="numeric" placeholder="es. 100" data-num="int" data-label="Larghezza pozzetto (cm)" />
        </label>

        <label>
          Diametro pozzetto (cm)
          <input id="diametroPozzetto" inputmode="numeric" placeholder="es. 100" data-num="int" data-label="Diametro pozzetto (cm)" />
        </label>

        <label>
          Profondit√† (m)
          <input id="profondita" inputmode="decimal" placeholder="es. 1.20" data-num="decimal" data-label="Profondit√† (m) Pozzetto" />
        </label>

        <label>
          Altro (Pozzetto)
          <input id="altroPozzetto" placeholder="Note aggiuntive (facoltativo)" />
        </label>
      </div>

      <h3 class="subhead">Condizioni / note</h3>
      <div class="grid3">
        <label>
          Ristagno (cm)
          <input id="ristagno" inputmode="numeric" placeholder="es. 5" data-num="int" data-label="Ristagno (cm)" />
        </label>

        <label>
          Appoggio di accesso
          <select id="appoggioAccesso">
            <option value="" selected>‚Äî Seleziona ‚Äî</option>
            <option>No</option>
            <option>Si</option>
          </select>
        </label>

        <label>
          Presenza di sedimenti
          <select id="presenzaSedimenti">
            <option value="" selected>‚Äî Seleziona ‚Äî</option>
            <option>No</option>
            <option>Si</option>
          </select>
        </label>

        <label>
          Altro (Condizioni / note)
          <input id="noteCondizioni" placeholder="Note aggiuntive (facoltativo)" />
        </label>
      </div>
    </section>

    <!-- CONDOTTE -->
    <section class="card">
      <div class="condotteHeader">
        <h2 class="sectionTitle">Condotte presenti</h2>

        <img
          class="condotteImg"
          src="./icons/dir_tubi.jpg"
          width="248"
          height="212"
          alt="Direzione tubi / numerazione condotte"
        />
      </div>

      <div class="condotteFixed">
        <div class="row">
          <button id="btnAddCondotta" type="button">+ Aggiungi condotta</button>
          <button id="btnClearCondotte" type="button" class="secondary">Svuota</button>
        </div>

        <div class="tableWrap condotteTableWrap">
          <table id="tblCondotte">
            <thead>
              <tr>
                <th>ID schema</th>
                <th>Tipologia</th>
                <th>Profondit√† (m)</th>
                <th>Diametro (mm)</th>
                <th>Larghezza (cm)</th>
                <th>Altezza (cm)</th>
                <th>Materiale</th>
                <th>Sezione</th>
                <th>Colore</th>
                <th></th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>

        <p class="hint">
          Profondit√†: usa il punto (es. 1.20). Non usare la virgola (,).
        </p>
      </div>
    </section>

    <!-- FOTO -->
    <section class="card">
      <h2>Foto</h2>
      <div class="row">
        <input id="fotoInput" type="file" accept="image/*" capture="environment" multiple />
        <button id="btnClearFotos" type="button" class="secondary">Rimuovi tutte</button>
      </div>
      <div id="fotoGrid" class="fotoGrid"></div>
    </section>

    <!-- AZIONI -->
    <section class="card">
      <h2>Azioni</h2>
      <div class="row wrap">
        <button id="btnSaveExport" type="button">üíæ‚¨áÔ∏è Salva + Esporta JSON</button>

        <input id="importJson" type="file" accept=".json,application/json" style="display:none" />
        <button id="btnImport" type="button" class="secondary">üì• Importa JSON</button>

        <button id="btnLoad" type="button" class="secondary">üìÇ Carica</button>
        <button id="btnNew" type="button" class="danger">üßπ Nuova scheda</button>
      </div>
      <div id="msg" class="msg"></div>
    </section>
  </main>

  <footer>
    <small>Demo PWA offline + salvataggio locale (IndexedDB)</small>
  </footer>

  <!-- MODAL RITAGLIO -->
  <div id="cropModal" class="modal hidden">
    <div class="modalCard">
      <div class="modalHeader">
        <h3>Ritaglia foto</h3>
        <button id="btnCropClose" type="button" class="secondary">Chiudi</button>
      </div>

      <div class="cropStage">
        <img id="cropImage" alt="Crop preview">
      </div>

      <div class="row wrap" style="margin-top:10px;">
        <button id="btnCropRotateL" type="button" class="secondary">‚ü≤ Ruota</button>
        <button id="btnCropRotateR" type="button" class="secondary">‚ü≥ Ruota</button>
        <button id="btnCropReset" type="button" class="secondary">Reset</button>

        <div class="spacer"></div>

        <button id="btnCropUse" type="button">Usa ritaglio</button>
      </div>

      <p class="hint">Suggerimento: pizzica per zoomare (tablet) e trascina per spostare.</p>
    </div>
  </div>

  <script src="./vendor/cropper/cropper.min.js"></script>
  <script src="./db.js"></script>
  <script src="./app.js"></script>
</body>
</html>
